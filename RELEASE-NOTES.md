# 发布说明 v1.1.0

## 🎯 本次发布重点

**修复关键 Bug**: 用户信息同步问题  
**影响范围**: 所有使用 Socket.io 的客户端  
**发布时间**: 2025-01-XX  
**优先级**: 🔴 高优先级（建议立即更新）

---

## 🐛 修复的问题

### 用户信息同步 Bug
**问题描述**: 当多个用户登录聊天系统时，新用户登录会导致已在线用户的身份信息被错误同步。

**影响**:
- 用户ID和SocketID信息混乱
- 消息发送方显示错误
- 多用户场景下用户体验严重受损

**修复方案**: 重新设计 Socket.io 事件结构，分离用户自身登录和其他用户加入的事件处理。

---

## ✨ 新增功能

### 新的 Socket.io 事件

#### `user:new-member-joined`
- **用途**: 通知现有用户有新成员加入
- **触发时机**: 当有新用户加入聊天室时
- **数据结构**: 包含完整的新用户信息和更新后的在线用户列表

```typescript
interface NewMemberJoinedData {
  newMember: OnlineUser      // 新加入的用户
  onlineUsers: OnlineUser[]  // 更新后的在线用户列表
}
```

---

## 🔄 变更内容

### Socket.io 事件变更

| 事件名 | 变更类型 | 说明 |
|--------|----------|------|
| `user:joined` | 🔧 修改 | 现在仅用于用户自身登录成功确认 |
| `user:new-member-joined` | ✨ 新增 | 用于通知其他用户有新成员加入 |

### TypeScript 类型更新

| 类型名 | 变更类型 | 说明 |
|--------|----------|------|
| `NewMemberJoinedData` | ✨ 新增 | 新成员加入事件的数据类型 |
| `OnlineUser` | 📝 文档更新 | 更新了使用说明 |

---

## 📱 客户端适配要求

### 🚨 必须完成的更新

1. **添加新事件监听器**
   ```javascript
   socket.on('user:new-member-joined', (data) => {
     // 处理新成员加入
   });
   ```

2. **修改现有事件处理**
   ```javascript
   socket.on('user:joined', (data) => {
     // 仅处理自己的登录成功
   });
   ```

### ⚠️ 兼容性说明

- **向后兼容**: `user:joined` 事件的数据结构保持不变
- **新增依赖**: 必须监听 `user:new-member-joined` 事件
- **移除功能**: 不再通过 `user:joined` 处理其他用户加入

---

## 🧪 测试建议

### 关键测试场景

1. **多用户登录测试**
   - 用户A登录 → 用户B登录
   - 验证用户A收到正确的新成员通知
   - 验证用户A的身份信息不变

2. **用户信息一致性测试**
   - 验证用户ID和SocketID保持一致
   - 验证在线用户列表更新正确

3. **现有功能回归测试**
   - 消息发送接收正常
   - 用户离开通知正常
   - 在线状态更新正常

---

## 📊 性能影响

- **网络开销**: 几乎无影响
- **内存使用**: 无影响  
- **处理性能**: 无影响
- **兼容性**: 需要客户端代码更新

---

## 🚀 升级路径

### 方案 1: 立即升级（推荐）
1. 阅读 [迁移指南](./MIGRATION-GUIDE.md)
2. 更新客户端事件监听代码
3. 测试多用户连接场景
4. 部署到生产环境

### 方案 2: 渐进式升级
1. 在开发环境测试新版本
2. 逐步迁移部分功能
3. 完整测试后部署

---

## 📞 支持与反馈

### 获取帮助
- 📖 [完整变更说明](./API-CHANGES.md)
- 🔧 [客户端迁移指南](./MIGRATION-GUIDE.md)
- 📝 [版本变更日志](./CHANGELOG.md)

### 反馈渠道
- GitHub Issues: 技术问题和Bug报告
- 技术支持邮箱: tech-support@example.com
- 开发者群组: [链接]

---

## 🎯 下一步计划

- v1.1.1: 性能优化和小幅改进
- v1.2.0: 文件传输功能增强
- v2.0.0: 大版本更新（计划中）

---

**感谢您使用 IM 聊天系统！请及时更新以获得最佳体验。** 🚀